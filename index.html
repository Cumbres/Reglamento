<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reglamento Interno - Condominio Cumbres de Quilpu칠</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e67e22;
            --background-color: #f8f9fa;
            --text-color: #34495e;
            --card-bg-color: #ffffff;
            --border-color: #e9ecef;
            --shadow-color: rgba(0, 0, 0, 0.07);
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --highlight-yellow-bg: #fef08a; /* Tailwind yellow-200 */
            --highlight-yellow-text: #854d0e; /* Tailwind yellow-800 */
            --highlight-red-bg: #fecaca; /* Tailwind red-200 */
            --highlight-red-text: #991b1b; /* Tailwind red-800 */
        }

        body.dark-mode {
            --primary-color: #ecf0f1;
            --secondary-color: #3498db;
            --accent-color: #e67e22;
            --background-color: #1c2833;
            --text-color: #bdc3c7;
            --card-bg-color: #2c3e50;
            --border-color: #3a5064;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --highlight-yellow-bg: #422006;
            --highlight-yellow-text: #fef08a;
            --highlight-red-bg: #450a0a;
            --highlight-red-text: #fecaca;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.7;
            color: var(--text-color);
            background-color: var(--background-color);
            font-size: 16px;
            transition: font-size 0.3s ease, background-color 0.4s ease, color 0.4s ease;
        }
        
        #progress-bar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            z-index: 2000;
            background-color: transparent;
        }
        #progress-bar {
            height: 100%;
            width: 0;
            background-color: var(--secondary-color);
            transition: width 0.1s linear;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            color: var(--primary-color);
            text-align: center;
            font-size: 2.4rem;
            line-height: 1.3;
            margin-top: 30px;
            margin-bottom: 40px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--secondary-color);
            letter-spacing: 1px;
            transition: color 0.4s ease;
        }

        #control-panel {
            position: sticky;
            top: 10px;
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--card-bg-color);
            opacity: 0.95;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow-color);
            gap: 15px;
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }

        #search-container { display: flex; flex-grow: 1; max-width: 450px; }
        #search-input {
            flex-grow: 1; padding: 12px 15px; font-size: 1rem;
            border: 1px solid var(--border-color); border-radius: 8px 0 0 8px; outline: none;
            background-color: var(--background-color); color: var(--text-color);
            transition: all 0.3s;
        }
        #search-input:focus { border-color: var(--secondary-color); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        #search-button {
            background-color: var(--secondary-color); color: white; border: none; padding: 0 20px;
            font-size: 1.1rem; cursor: pointer; border-radius: 0 8px 8px 0; transition: background-color 0.3s;
        }
        #search-button:hover { background-color: #2980b9; }

        #button-container { display: flex; gap: 10px; }
        #button-container button {
            background-color: var(--background-color); color: var(--primary-color);
            border: 1px solid var(--border-color); width: 45px; height: 45px; font-size: 1rem;
            cursor: pointer; border-radius: 8px; transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
        }
        #button-container button:hover {
            background-color: var(--secondary-color); color: white;
            border-color: var(--secondary-color); transform: translateY(-2px);
        }
        #whatsapp-button { background-color: #25D366; color: white; border: none; }
        #whatsapp-button:hover { background-color: #128C7E; }
        #report-button { background-color: #e74c3c; color: white; border: none; }
        #report-button:hover { background-color: #c0392b; }

        /* Article Styles */
        .article {
            background-color: var(--card-bg-color); margin-bottom: 15px; border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color); transition: all 0.4s ease; overflow: hidden;
        }
        .article:hover { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); }
        body.dark-mode .article:hover { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }

        .article-title {
            cursor: pointer; font-weight: 500; font-size: 1.2rem; display: flex;
            align-items: center; padding: 20px 25px; user-select: none;
        }
        .article-title i.fa-info-circle, .article-title i.fas {
            margin-right: 15px; font-size: 1.5rem; width: 30px;
            text-align: center; color: var(--secondary-color);
        }
        .article-title .chevron-icon { margin-left: auto; transition: transform 0.3s ease; font-size: 1rem; }
        .article.active .chevron-icon { transform: rotate(180deg); }

        .article-content {
            max-height: 0; overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding-top 0.5s ease-in-out, padding-bottom 0.5s ease-in-out;
            padding-left: 70px; padding-right: 25px;
        }
        .article.active .article-content { padding-top: 10px; padding-bottom: 25px; max-height: 5000px; }
        .article-content p, .article-content ul, .article-content ol { margin-bottom: 1rem; }
        .article-content ul, .article-content ol { padding-left: 20px; }
        .article-content strong { color: var(--primary-color); transition: color 0.4s ease; }
        .article-content a { color: var(--secondary-color); text-decoration: none; font-weight: 500; }
        .article-content a:hover { text-decoration: underline; }
        .article-content u { text-decoration-color: var(--accent-color); }
        .article-content mark {
            background-color: var(--highlight-yellow-bg);
            color: var(--highlight-yellow-text);
            padding: 2px 4px;
            border-radius: 3px;
        }
        .article-content mark.danger {
            background-color: var(--highlight-red-bg);
            color: var(--highlight-red-text);
        }

        .search-highlight-permanent {
            background-color: var(--highlight-yellow-bg);
            color: var(--highlight-yellow-text);
            border-radius: 3px;
            padding: 1px 3px;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        .schedule-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin: 20px 0;
        }
        .schedule-card-detailed { border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color); }
        .schedule-card-detailed .header {
            padding: 12px 15px; color: white; font-weight: 700; font-size: 1rem;
            display: flex; align-items: center; gap: 10px;
        }
        .schedule-card-detailed .header.allowed { background-color: var(--success-color); }
        .schedule-card-detailed .header.prohibited { background-color: var(--danger-color); }
        .schedule-card-detailed .body { padding: 15px; background-color: var(--card-bg-color); transition: background-color 0.4s ease; }
        .schedule-card-detailed .body p { margin: 0; font-size: 0.95rem; }
        .schedule-card-detailed .body .day { font-weight: 700; color: var(--primary-color); margin-bottom: 5px; transition: color 0.4s ease; }
        .schedule-card-detailed .body .time { font-size: 1.2rem; font-weight: 500; color: var(--text-color); margin-bottom: 5px; transition: color 0.4s ease; }
        .schedule-card-detailed .body .time-block { margin-bottom: 10px; }
        .schedule-card-detailed .body .time-block:last-child { margin-bottom: 0; }
        .schedule-card-detailed .body .status { font-weight: 700; font-size: 1.2rem; text-align: center; }

        /* Popups */
        .popup {
            display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
            align-items: center; justify-content: center;
        }
        .popup.show { display: flex; }
        .popup-content {
            background-color: var(--card-bg-color); padding: 30px 40px; border-radius: 15px;
            width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative; animation: fadeIn 0.3s ease-out;
            transition: background-color 0.4s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .popup-content h3 { color: var(--primary-color); margin-bottom: 20px; font-size: 1.5rem; transition: color 0.4s ease; }
        .popup-content .close {
            position: absolute; top: 15px; right: 20px; color: #aaa; font-size: 32px;
            font-weight: bold; cursor: pointer; transition: color 0.2s;
        }
        .popup-content .close:hover { color: var(--danger-color); }
        .popup-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; }
        .popup-buttons button {
            padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer;
            font-size: 1rem; font-weight: 500; transition: all 0.3s ease;
        }
        .popup-buttons .confirm-btn { background-color: var(--secondary-color); color: white; }
        .popup-buttons .confirm-btn:hover { background-color: #2980b9; }
        .popup-buttons .cancel-btn { background-color: var(--border-color); color: var(--text-color); }
        .popup-buttons .cancel-btn:hover { background-color: #bdc3c7; }
        #tip-text { font-size: 1.1rem; margin-bottom: 10px; }
        #tip-source { font-style: italic; color: #7f8c8d; }
        #next-tip { background-color: var(--accent-color); color: white; }
        #next-tip:hover { background-color: #d35400; }
        #search-results-content { max-width: 800px; }
        #search-results { max-height: 60vh; overflow-y: auto; margin-top: 20px; }
        .search-result-item { padding: 15px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background-color 0.2s, border-color 0.4s ease; }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-item:hover { background-color: var(--background-color); }
        .search-result-item strong { color: var(--secondary-color); }
        .search-result-item .highlight { background-color: var(--highlight-yellow-bg); color: var(--highlight-yellow-text); border-radius: 3px; padding: 0 2px;}

        /* Report Form Styles */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: var(--text-color); }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color);
            background-color: var(--background-color); color: var(--text-color);
            font-family: 'Inter', sans-serif; font-size: 1rem;
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        
        /* Chatbot Styles */
        #chatbot-fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background-color: var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 1010;
            font-size: 28px; /* For emoji */
        }
        #chatbot-fab:hover { transform: scale(1.1); }
        
        #chatbot-window {
            position: fixed;
            bottom: 100px;
            right: 25px;
            width: 350px;
            max-width: 90vw;
            height: 500px;
            max-height: 70vh;
            background-color: var(--card-bg-color);
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.5) translateY(100px);
            opacity: 0;
            pointer-events: none;
            transform-origin: bottom right;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1009;
        }
        #chatbot-window.active {
            transform: scale(1) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        .chatbot-header {
            background-color: var(--accent-color);
            color: white;
            padding: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px; /* For emoji */
        }
        .chatbot-messages { flex-grow: 1; padding: 15px; overflow-y: auto; }
        .chat-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .bot-message {
            background-color: var(--border-color);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        .user-message {
            background-color: var(--secondary-color);
            color: white;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }
        .chatbot-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--border-color);
        }
        #chatbot-input {
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 10px;
            background-color: transparent;
            color: var(--text-color);
        }
        #chatbot-send {
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 10px;
        }

        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.95rem; }
        th, td { border: 1px solid var(--border-color); padding: 12px; text-align: left; transition: border-color 0.4s ease; }
        th { background-color: var(--background-color); font-weight: bold; color: var(--primary-color); transition: background-color 0.4s ease, color 0.4s ease; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        body.dark-mode tr:nth-child(even) { background-color: #34495e; }

        footer { margin-top: 50px; padding: 30px; background-color: var(--primary-color); text-align: center; font-size: 0.9rem; color: #bdc3c7; transition: background-color 0.4s ease; }

        @media screen and (max-width: 768px) {
            h1 { font-size: 2rem; }
            #control-panel { flex-direction: column; align-items: stretch; top: 0; border-radius: 0; }
            #search-container { max-width: none; }
            #button-container { justify-content: center; margin-top: 15px; }
            .article-title { font-size: 1.1rem; padding: 15px 20px; }
            .article-content { padding-left: 20px; padding-right: 20px; }
        }
    </style>
</head>
<body>

<div id="progress-bar-container"><div id="progress-bar"></div></div>

<div class="container">

    <!-- Popups -->
    <div id="tip-popup" class="popup"><div class="popup-content"><span class="close" data-popup-id="tip-popup">&times;</span><h3><i class="fas fa-lightbulb" style="color: var(--accent-color);"></i> Tip del D칤a</h3><p id="tip-text"></p><p id="tip-source"></p><div class="popup-buttons"><button id="next-tip" class="confirm-btn">Siguiente Tip</button></div></div></div>
    <div id="whatsapp-popup" class="popup"><div class="popup-content"><span class="close" data-popup-id="whatsapp-popup">&times;</span><h3><i class="fab fa-whatsapp" style="color: #25D366;"></i> Contacto con Conserjer칤a</h3><p>A este n칰mero se contactar치 a WhatsApp de conserjer칤a, para informar cualquier problema, irregularidad u otro tema que corresponda. 쮻esea continuar?</p><div class="popup-buttons"><button id="cancel-whatsapp" class="cancel-btn">Cancelar</button><button id="confirm-whatsapp" class="confirm-btn">S칤, continuar</button></div></div></div>
    <div id="report-popup" class="popup">
        <div class="popup-content">
            <span class="close" data-popup-id="report-popup">&times;</span>
            <h3><i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i> Reportar Infracci칩n</h3>
            <form id="report-form">
                <div class="form-group">
                    <label for="report-name">Tu Nombre (Opcional)</label>
                    <input type="text" id="report-name" placeholder="An칩nimo">
                </div>
                <div class="form-group">
                    <label for="report-unit">Tu Unidad/Depto (Opcional)</label>
                    <input type="text" id="report-unit" placeholder="Ej: Torre A - 101">
                </div>
                <div class="form-group">
                    <label for="report-article">Art칤culo Involucrado</label>
                    <select id="report-article" required></select>
                </div>
                <div class="form-group">
                    <label for="report-involved">Persona/Unidad Involucrada (Si se conoce)</label>
                    <input type="text" id="report-involved" placeholder="Ej: Vecino del 202">
                </div>
                <div class="form-group">
                    <label for="report-description">Descripci칩n de la situaci칩n</label>
                    <textarea id="report-description" required placeholder="Por favor, sea lo m치s detallado posible..."></textarea>
                </div>
                <div class="popup-buttons">
                    <button type="button" class="cancel-btn" data-popup-id="report-popup">Cancelar</button>
                    <button type="submit" class="confirm-btn" style="background-color: #c0392b;">Enviar Reporte</button>
                </div>
            </form>
        </div>
    </div>
    <div id="search-results-popup" class="popup"><div id="search-results-content" class="popup-content"><span class="close" data-popup-id="search-results-popup">&times;</span><h3>Resultados de la B칰squeda</h3><div id="search-results"></div></div></div>
    
    <header>
        <div id="control-panel">
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Buscar en el reglamento...">
                <button id="search-button" aria-label="Buscar"><i class="fas fa-search"></i></button>
            </div>
            <div id="button-container">
                <button id="decrease-font" aria-label="Disminuir tama침o de letra">A-</button>
                <button id="increase-font" aria-label="Aumentar tama침o de letra">A+</button>
                <button id="theme-toggle" aria-label="Cambiar tema"><i class="fas fa-moon"></i></button>
                <button id="show-tip" aria-label="Mostrar tip del d칤a"><i class="fas fa-info-circle"></i></button>
                <button id="whatsapp-button" aria-label="Contactar por WhatsApp"><i class="fab fa-whatsapp"></i></button>
                <button id="report-button" aria-label="Reportar infracci칩n"><i class="fas fa-exclamation-triangle"></i></button>
            </div>
        </div>
        <h1>Reglamento Interno<br>Condominio Cumbres de Quilpu칠</h1>
    </header>

    <main id="articles-container"></main>

    <!-- Chatbot -->
    <div id="chatbot-fab">游붉</div>
    <div id="chatbot-window">
        <div class="chatbot-header">
            <span class="fox-emoji">游붉</span>
            <span>Asistente del Condominio</span>
        </div>
        <div class="chatbot-messages" id="chatbot-messages"></div>
        <div class="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Preg칰ntame algo...">
            <button id="chatbot-send"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

</div>

<footer>
  <p>Dise침ado por el Comit칠 de Cumbres de Quilpu칠. &copy; 2024 Todos los derechos reservados.</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const articlesData = [
        { id: 'intro', icon: 'fas fa-info-circle', title: 'Introducci칩n: Disposiciones Generales', content: `<p>El presente Reglamento de Normas Internas ha sido dictado por el Comit칠 Administraci칩n y por la administraci칩n conforme a lo establecido en la Ley 21.442 sobre la Copropiedad Inmobiliaria y Reglamento de Copropiedad de la comunidad, el que se da por conocido de todo habitante, residente y usuario de departamentos y/o locales comerciales a cualquier t칤tulo, que tiene por objetivo principalmente lo siguiente:</p><ul><li>Normar el uso y goce de los espacios comunes.</li><li>Mantener el valor de los activos de la comunidad.</li><li>Mantener una sana convivencia entre todos los residentes de la comunidad.</li><li>Seguridad y Prevenci칩n de Riesgos de los residentes.</li><li>Ordenar el uso, goce y preservar las 치reas comunes de la comunidad.</li><li>Complementar y aclarar reglamento de copropiedad, gravamen de cada unidad.</li></ul><p>De esta forma, en 칠l se han definido una serie de normas y procedimientos que deber치n ser observados por los copropietarios o sus arrendatarios para el uso de los bienes comunes, estableci칠ndose adem치s la aplicaci칩n de multas ante ciertas situaciones, las que ser치n cobradas en conjunto con los gastos comunes. Cabe destacar que sobre los bienes de dominio com칰n existe un derecho de propiedad de todos y cada uno de los copropietarios, en proporci칩n al prorrateo respectivo.</p><p>El presente documento se enmarca en la dictaci칩n de normas vigentes a la fecha de publicaci칩n de este reglamento interno. Refleja la ley de copropiedad 21.442, la ley 21.020 sobre tenencia responsable de mascotas y las normas u ordenanzas municipales y gubernamentales.</p><p><strong>El objetivo final de este Reglamento Interno es obtener una mejor calidad de vida para todos los residentes.</strong></p>`},
        { id: 'articulo-1', icon: 'fas fa-volume-up', title: 'Art칤culo 1: Ruidos Molestos', content: `<p>1.1. Se proh칤be causar ruidos molestos que perturben la tranquilidad de los vecinos, especialmente entre las <mark>22:00 y las 08:00 horas</mark>.</p><p>1.2. El l칤mite de ruido permitido es de <strong>60 decibeles</strong> (ORD.MUN 06/2023).</p><p>1.3. Horarios para actividades de <strong>construcci칩n y remodelaci칩n</strong>:</p><div class="schedule-container"><div class="schedule-card-detailed"><div class="header allowed"><i class="fas fa-check-circle"></i> Permitido</div><div class="body"><p class="day">Lunes a S치bado</p><div class="time-block"><p class="time">09:00 - 13:00</p></div><div class="time-block"><p class="time">15:00 - 18:00</p></div></div></div><div class="schedule-card-detailed"><div class="header prohibited"><i class="fas fa-times-circle"></i> Prohibido</div><div class="body"><p class="day">Domingos y Festivos</p><p class="status">TODO EL D칈A</p></div></div></div><p>1.4. Las infracciones a este art칤culo ser치n sancionadas con <strong>multas de 1 a 3 UTM</strong>, seg칰n la gravedad y reiteraci칩n de la falta.</p>`},
        { id: 'articulo-2', icon: 'fas fa-glass-cheers', title: 'Art칤culo 2: Reuniones Sociales', content: `<p>2.1. Horarios permitidos para <strong>reuniones sociales</strong>:</p><div class="schedule-container"><div class="schedule-card-detailed"><div class="header allowed"><i class="fas fa-check-circle"></i> Permitido</div><div class="body"><p class="day">Domingo a Jueves</p><div class="time-block"><p class="time">Hasta las 22:00</p></div></div></div><div class="schedule-card-detailed"><div class="header allowed"><i class="fas fa-check-circle"></i> Permitido</div><div class="body"><p class="day">Viernes, S치bados y V칤speras de Festivos</p><div class="time-block"><p class="time">Hasta las 02:00</p></div></div></div></div><p>2.2. Se debe cuidar los niveles de ruido provocados por artefactos o personas. <strong>La intensidad de los artefactos debe ser moderada.</strong></p><p>2.3. Las actividades sociales podr치n ser <u>suspendidas por la Administraci칩n o el personal de Conserjer칤a</u> si alteran notoriamente la tranquilidad de cualquier residente.</p><p>2.4. Los residentes pueden solicitar la intervenci칩n de <strong>Carabineros de Chile o Seguridad Ciudadana</strong> para suspender actividades que causen molestias.</p><p>2.5. Para reuniones con <mark>m치s de 15 invitados</mark>, se debe informar la lista al conserje.</p><p>2.6. Se proh칤be que los invitados extiendan las fiestas a jardines o cualquier otro espacio com칰n del condominio.</p><p>2.7. Las infracciones a este art칤culo ser치n sancionadas con <strong>multas de 1 a 3 UTM</strong>, seg칰n la gravedad de la falta.</p>`},
        { id: 'articulo-3', icon: 'fas fa-door-open', title: 'Art칤culo 3: Acceso al Condominio', content: `<p>3.1. El ingreso de visitas debe ser <strong>autorizado por un residente</strong> a trav칠s de la Plataforma Virtual o cit칩fono.</p><p>3.2. Las mudanzas y cargas deben ser avisadas con <strong>24 horas de anticipaci칩n</strong>. Se debe registrar el nombre, c칠dula de identidad, patente del veh칤culo y departamento involucrado.</p><p>3.3. Los servicios de <strong>delivery</strong> solo pueden ingresar hasta el acceso principal, y se permitir치 un delivery a la vez. El proceso es:</p><ul><li>El residente debe <u>avisar previamente</u> a conserjer칤a.</li><li>La entrega se realiza en el <u>acceso principal</u> de la torre.</li><li>El residente debe <u>verificar que el delivery se retire</u>.</li></ul><p>3.4. <mark class="danger">No se permitir치 la entrada de personas sin autorizaci칩n previa de un residente responsable.</mark></p>`},
        { id: 'articulo-4', icon: 'fas fa-paw', title: 'Art칤culo 4: Animales Dom칠sticos', content: `<p>En relaci칩n a la ley de copropiedad 21.442 y ley 21.020 sobre tenencia responsable de mascotas y animales de compa침칤a:</p><ul><li>Los due침os son <strong>responsables de cualquier da침o</strong> generado por sus mascotas.</li><li>Las mascotas deben transitar <strong>amarradas y acompa침adas por un adulto</strong>.</li><li>Las suciedades deben ser <strong>recogidas inmediatamente</strong> por los due침os.</li><li>Se proh칤be la <strong>libre circulaci칩n</strong> de mascotas sin compa침칤a de su due침o.</li><li>Los perros de razas consideradas agresivas (Rottweiler, Doberman, Pitbull y otros) deben circular en todo momento con un adulto y <mark>obligatoriamente con bozal</mark>.</li><li>La adquisici칩n de una nueva mascota debe ser <strong>comunicada a la Administraci칩n</strong>.</li></ul><p>Las infracciones a este art칤culo ser치n sancionadas con <strong>multas de 1 a 3 UTM</strong> seg칰n la gravedad de la falta.</p>`},
        { id: 'articulo-5', icon: 'fas fa-trash-alt', title: 'Art칤culo 5: Desechos y Basura', content: `<p>5.1. Horario para la <strong>evacuaci칩n de basura</strong>:</p><div class="schedule-container"><div class="schedule-card-detailed"><div class="header allowed"><i class="fas fa-check-circle"></i> Permitido</div><div class="body"><p class="day">Todos los d칤as</p><div class="time-block"><p class="time">09:00 - 22:00</p></div></div></div></div><p>5.2. La basura debe ser depositada en <strong>bolsas pl치sticas debidamente amarradas</strong> antes de ser evacuadas por el conducto de basura.</p><p>5.3. Se debe dejar libre de residuos y las <strong>puertas cerradas del shaft</strong> para evitar malos olores.</p><p>5.4. Est치 <mark class="danger">estrictamente prohibido arrojar por los ductos</mark>:</p><ul><li>Materiales de construcci칩n</li><li>Elementos inflamables</li><li>Vidrios o cartones de gran tama침o</li></ul><p>5.5. Los materiales de construcci칩n y escombros deben ser retirados por el contratista. <strong>No se permite su almacenaje en 치reas comunes.</strong></p><p>5.7. Las infracciones a este art칤culo ser치n sancionadas con <strong>multas de 1 a 3 UTM</strong> seg칰n la gravedad de la falta.</p>`},
        { id: 'articulo-6', icon: 'fas fa-building', title: 'Art칤culo 6: Est칠tica y Cierre de Balcones', content: `<p>6.1. Queda <strong>estrictamente prohibido</strong>:</p><ul><li><mark>Colgar toallas, s치banas, frazadas, ropa, maceteros</mark> o cualquier otro elemento en las terrazas sobrepasando la l칤nea visual del balc칩n hacia el exterior.</li><li><strong>Arrojar objetos o desperdicios</strong>, sacudir alfombras, etc. hacia el exterior.</li><li>Extender lonas, banderas, letreros, etc. en murallas exteriores y barandas.</li></ul><p>6.2. Para el <strong>cierre de terrazas</strong>, se deber치n seguir las indicaciones de materiales y colores especificados (ventanales blancos de PVC, etc.).</p><p>6.3. Las cortinas visibles desde el exterior deben ser de <strong>color crudo</strong>.</p><p>6.4. <mark>Todas las modificaciones deben ser autorizadas por la administraci칩n</mark> v칤a correo electr칩nico.</p><p>6.5. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-7', icon: 'fas fa-users', title: 'Art칤culo 7: Relaciones Administraci칩n-Residentes', content: `<p>7.3. <strong>Comunicaci칩n con la administraci칩n:</strong></p><ul><li>Los residentes deben dirigir sus observaciones, reclamos o ideas al comit칠 o la administraci칩n, <u>no al personal de servicio</u>.</li><li>Medios oficiales de comunicaci칩n: <strong>correo electr칩nico y Libro de Novedades</strong> en conserjer칤a.</li><li><mark>Queda prohibido acudir directamente a los departamentos de los miembros del comit칠</mark>, realizar llamadas o enviar mensajes a sus tel칠fonos personales o cit칩fonos.</li></ul><p>7.4. <strong>Personal de servicio:</strong></p><ul><li>Est치 <u>prohibido que realicen trabajos particulares</u> para residentes durante sus horas de trabajo.</li></ul><p>7.5. Se proh칤be estrictamente a residentes o propietarios ingresar o hacer uso de: <strong>conserjer칤a, bodega, sala de bombas, salas de electricidad</strong>, etc.</p><p>7.6. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-8', icon: 'fas fa-home', title: 'Art칤culo 8: Unidades y Departamentos', content: `<p>8.1. Las unidades son de <strong>uso exclusivo para habitaci칩n</strong>.</p><p>8.2. Est치 <mark class="danger">estrictamente prohibido el uso de las unidades como</mark>: Oficinas, Consultorios, Peluquer칤as, Salones de belleza, Moteles, u otros negocios.</p><p>8.3. El <strong>mantenimiento y reparaci칩n de las unidades es responsabilidad exclusiva de cada propietario</strong>.</p><p>8.5. El incumplimiento de este art칤culo ser치 sancionado con <strong>multas de 1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-9', icon: 'fas fa-car', title: 'Art칤culo 9: Estacionamientos y Circulaci칩n', content: `<p>9.1. <strong>Uso de estacionamientos:</strong></p><ul><li><u>Prohibido almacenar</u> mobiliario, bultos, cajones u otros desechos.</li><li>No se permite estacionar en <strong>치reas comunes o de circulaci칩n</strong>.</li><li>Los residentes deben usar <strong>solo sus estacionamientos asignados</strong>.</li></ul><p>9.2. <strong>Estacionamientos de visitas:</strong></p><ul><li>Uso exclusivo para visitas, <mark>m치ximo 8 horas continuas</mark>.</li></ul><p>9.3. <strong>Circulaci칩n:</strong></p><p><mark class="danger">La velocidad m치xima permitida es de 10 km/hora</mark></p><ul><li>Circular con <strong>luces bajas encendidas</strong>.</li><li><u>Prohibido tocar bocina</u>, excepto para evitar accidentes.</li></ul><p>9.4. <strong>Restricciones:</strong></p><ul><li>Prohibido usar estacionamientos como zona de <strong>reparaci칩n o lavado de veh칤culos</strong>.</li></ul><p>9.6. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-10', icon: 'fas fa-tree', title: 'Art칤culo 10: Espacios Comunes', content: `<p>10.2. Los <strong>da침os o deterioros</strong> que se produzcan [...] ser치n de <strong>responsabilidad del residente</strong> que haya hecho uso de ellos.</p><p>10.7. Est치 <mark class="danger">estrictamente prohibido en los espacios comunes</mark>:</p><ul><li><strong>Fumar o beber alcohol.</strong></li><li><strong>Realizar asados con carb칩n o madera</strong>, incluyendo en los balcones de los departamentos.</li><li>Botar colillas de cigarros u otros objetos.</li><li>Ocupar con muebles u otros objetos los pasillos, escaleras o cualquier otro espacio com칰n.</li></ul><p>10.8. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-11', icon: 'fas fa-truck-moving', title: 'Art칤culo 11: Mudanzas y Traslados', content: `<p>11.1. Toda mudanza deber치 informarse a la administraci칩n o a conserjer칤a con <mark>48 horas de anticipaci칩n</mark>.</p><p>11.2. <strong>Horarios permitidos para mudanzas:</strong></p><div class="schedule-container"><div class="schedule-card-detailed"><div class="header allowed"><i class="fas fa-check-circle"></i> Permitido</div><div class="body"><p class="day">Lunes a S치bado</p><div class="time-block"><p class="time">09:00 - 18:00</p></div></div></div><div class="schedule-card-detailed"><div class="header prohibited"><i class="fas fa-times-circle"></i> Prohibido</div><div class="body"><p class="day">Domingo y Festivos</p><p class="status">TODO EL D칈A</p></div></div></div><p><mark class="danger">* No se puede empezar antes, ni terminar despu칠s de los horarios establecidos.</mark></p><p>11.3. Cualquier da침o que se produzca por la mudanza ser치 cobrado al departamento involucrado m치s una multa.</p><p>11.5. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-12', icon: 'fas fa-key', title: 'Art칤culo 12: Arriendos', content: `<p>12.1. Es <strong>responsabilidad del propietario comunicar por escrito</strong> el nombre de su arrendatario.</p><p>12.3. Los conserjes <u>no est치n autorizados para recibir ni entregar llaves</u>.</p><p>12.4. <mark class="danger">Queda estrictamente prohibido arrendar bodegas o estacionamientos a personas ajenas al condominio.</mark></p><p>12.5. El incumplimiento ser치 multado desde <strong>1 a 3 UTM</strong>.</p>`},
        { id: 'articulo-13', icon: 'fas fa-fire-extinguisher', title: 'Art칤culo 13: Prevenci칩n de Incendios', content: `<p>13.2. Se considerar치n <strong>faltas graves</strong> que atentan contra la seguridad:</p><ul><li><mark class="danger">Arrojar colillas de cigarrillos encendidas</mark> o cualquier tipo de material en combusti칩n en 치reas comunes.</li><li><mark class="danger">Utilizar parrillas, braseros o cualquier otro artefacto que requiera el uso de carb칩n o le침a</mark> en terrazas, balcones o 치reas comunes.</li><li>Almacenar o dejar <strong>materiales inflamables</strong> o explosivos en 치reas comunes.</li><li><strong>Obstruir o bloquear las v칤as de evacuaci칩n</strong>, salidas de emergencia, o extintores.</li></ul><p>13.3. Las infracciones descritas ser치n sancionadas como <strong>faltas graves</strong>.</p>`},
        { id: 'articulo-14', icon: 'fas fa-hands-helping', title: 'Art칤culo 14: Convivencia en Comunidad', content: `<p>14.1. Toda <strong>agresi칩n f칤sica o verbal</strong> a residentes, trabajadores o a los bienes de la comunidad ser치 <strong>multada con un m칤nimo de 1 UTM hasta un m치ximo de 3 UTM</strong>.</p><p>14.2. Los incidentes de agresi칩n podr치n ser <u>denunciados ante la autoridad correspondiente</u>.</p><p>14.3. Esta reglamentaci칩n aplica a todo tipo de residentes, <strong>incluyendo sus visitas y familiares</strong>.</p>`},
        { id: 'articulo-15', icon: 'fas fa-video', title: 'Art칤culo 15: Uso de Grabaciones y Fotograf칤as', content: `<p>15.1. El condominio cuenta con un <strong>circuito cerrado de c치maras de seguridad</strong>.</p><p>15.3. El Comit칠 y la Administraci칩n podr치n emplear las grabaciones y fotograf칤as como <strong>evidencia para determinar infracciones y cursar multas</strong>.</p><p>15.5. El uso de las grabaciones y fotograf칤as se realizar치 respetando la normativa vigente en materia de <strong>protecci칩n de datos personales y privacidad</strong>.</p>`},
        { id: 'articulo-16', icon: 'fas fa-child', title: 'Art칤culo 16: Uso de 츼reas Comunes por Ni침os', content: `<p>16.2. Quedan <strong>excluidas como zonas de juego</strong> para ni침os las siguientes 치reas comunes: <mark>bodegas, estacionamientos, pasillos de torres, conserjer칤a, salas de basura</mark> y cualquier otro lugar que represente un riesgo.</p><p>16.3. Los <strong>padres, madres o tutores legales</strong> ser치n directa y plenamente <strong>responsables por cualquier da침o, deterioro o perjuicio</strong> que los ni침os ocasionen.</p><p>16.5. Los padres, madres o tutores legales deber치n <strong>supervisar en todo momento a los ni침os</strong> bajo su cuidado mientras permanezcan en las 치reas comunes.</p><p>16.6. Queda estrictamente prohibido cualquier tipo de conducta agresiva, violenta, acoso, <strong>bullying</strong> o discriminaci칩n por parte de ni침os.</p>`},
        { id: 'articulo-17', icon: 'fas fa-money-bill-wave', title: 'Art칤culo 17: Morosidad en Gastos Comunes', content: `<p>Seg칰n lo establecido en la ley de copropiedad 21.442, se refuerzan las sanciones para las unidades morosas en <strong>3 o m치s meses</strong> (consecutivos o no), donde la administraci칩n tendr치 facultad para <mark class="danger">suspender o requerir suspensi칩n del servicio el칠ctrico, de telecomunicaciones o de calefacci칩n</mark>.</p>`},
        { id: 'articulo-18', icon: 'fas fa-clipboard-list', title: 'Art칤culo 18: Registro de Residentes', content: `<p>Ser치 <strong>obligaci칩n de cada copropietario informar por escrito</strong> a la Administraci칩n los datos de todas las personas que residan en su unidad, <mark>dentro de los 15 d칤as siguientes al inicio de la residencia</mark>.</p><p>El incumplimiento de esta obligaci칩n ser치 considerado una <strong>falta grave</strong> y se aplicar치 la multa correspondiente.</p>`},
        { id: 'articulo-19', icon: 'fas fa-exclamation-triangle', title: 'Art칤culo 19: Infracciones y Multas', content: `<p>La infracci칩n de cualquier norma se sancionar치 con <strong>multa de 1 a 3 UTM</strong>. La reincidencia se considerar치 como agravante.</p><p>Las faltas se clasifican en:</p><ul><li><strong>Faltas leves (Multa de 1 UTM):</strong> Infracciones menores sin da침os ni molestias significativas.</li><li><strong>Faltas graves (Multa de 2 UTM):</strong> Infracciones que causen molestias, perjuicios o riesgos relevantes.</li><li><strong>Faltas muy graves (Multa desde 3 UTM):</strong> Infracciones que causen da침os materiales significativos, pongan en riesgo la seguridad, o impliquen agresiones.</li></ul>`},
        { id: 'articulo-20', icon: 'fas fa-gavel', title: 'Art칤culo 20: Reconsideraci칩n de Multas', content: `<h3>20.1 Reconsideraci칩n de Multas</h3><p>El copropietario o residente puede presentar un <strong>recurso de reconsideraci칩n</strong>, <mark>dentro de los primeros 15 d칤as corridos desde la notificaci칩n de la multa</mark>, donde podr치 solicitar la condonaci칩n total o parcial de lo cobrado.</p><p>La presentaci칩n del recurso deber치 ser enviada por correo electr칩nico a la administraci칩n.</p><h3>20.2 Resumen del Proceso de Infracciones</h3><table><tr><th>Etapa</th><th>Descripci칩n</th></tr><tr><td>Identificaci칩n de falta</td><td>El residente informa a conserjer칤a. El conserje verifica y deja constancia.</td></tr><tr><td>Notificaci칩n de la multa</td><td>La Administraci칩n notifica al residente por correo electr칩nico.</td></tr><tr><td>Plazo para apelar</td><td>El residente tiene 15 d칤as corridos para presentar un recurso.</td></tr><tr><td>Presentaci칩n del recurso</td><td>El recurso se env칤a por correo electr칩nico a la Administraci칩n.</td></tr><tr><td>An치lisis y Resoluci칩n</td><td>El Comit칠 y la Administraci칩n analizan y resuelven el caso.</td></tr><tr><td>Notificaci칩n de la resoluci칩n</td><td>Se notifica al residente la decisi칩n final.</td></tr></table>`},
        { id: 'modificacion', icon: 'fas fa-file-alt', title: 'Modificaci칩n del Reglamento Interno', content: `<p>El Comit칠 de Administraci칩n, en conjunto con la administraci칩n, <strong>verificar치 una vez al a침o el presente reglamento interno</strong> y har치 las modificaciones que se necesiten de acuerdo a las actuales necesidades de la comunidad.</p>`}
    ];

    const articlesContainer = document.getElementById('articles-container');
    const reportArticleSelect = document.getElementById('report-article');
    
    // Populate articles and report form dropdown
    articlesData.forEach(data => {
        const articleEl = document.createElement('div');
        articleEl.className = 'article';
        articleEl.id = data.id;
        articleEl.innerHTML = `
            <div class="article-title">
                <i class="${data.icon}"></i>
                <span>${data.title}</span>
                <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="article-content">${data.content}</div>
        `;
        articlesContainer.appendChild(articleEl);

        const option = document.createElement('option');
        option.value = data.title;
        option.textContent = data.title;
        reportArticleSelect.appendChild(option);
    });

    // --- ACCORDION LOGIC ---
    articlesContainer.addEventListener('click', e => {
        const title = e.target.closest('.article-title');
        if (title) {
            title.parentElement.classList.toggle('active');
            return;
        }
    });

    // --- THEME TOGGLE ---
    const themeToggle = document.getElementById('theme-toggle');
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        let theme = 'light';
        if (document.body.classList.contains('dark-mode')) {
            theme = 'dark';
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
        localStorage.setItem('theme', theme);
    });

    // --- POPUP/MODAL LOGIC ---
    function showPopup(popupId) { document.getElementById(popupId)?.classList.add('show'); }
    function hidePopup(popupId) { document.getElementById(popupId)?.classList.remove('show'); }
    document.querySelectorAll('.popup .close, .cancel-btn').forEach(btn => {
        btn.addEventListener('click', () => hidePopup(btn.dataset.popupId || btn.closest('.popup').id));
    });
    document.querySelectorAll('.popup').forEach(popup => {
        popup.addEventListener('click', (e) => { if (e.target === popup) hidePopup(popup.id); });
    });

    // --- FONT SIZE CONTROLS ---
    let currentFontSize = 16;
    document.getElementById('decrease-font').addEventListener('click', () => {
        currentFontSize = Math.max(12, currentFontSize - 1);
        document.body.style.fontSize = currentFontSize + 'px';
    });
    document.getElementById('increase-font').addEventListener('click', () => {
        currentFontSize = Math.min(22, currentFontSize + 1);
        document.body.style.fontSize = currentFontSize + 'px';
    });
    
    // --- ACTION BUTTONS LOGIC ---
    const tips = [
        { text: "Recuerda que la velocidad m치xima dentro del condominio es de 10 km/h.", source: "Art칤culo 9" },
        { text: "Las mascotas deben transitar siempre con correa y acompa침adas por un adulto.", source: "Art칤culo 4" },
        { text: "Est치 prohibido colgar ropa, toallas o alfombras en los balcones.", source: "Art칤culo 6" },
        { text: "Las mudanzas no est치n permitidas los domingos ni festivos.", source: "Art칤culo 11" },
        { text: "No se pueden realizar asados con carb칩n o le침a en terrazas y balcones.", source: "Art칤culo 10" },
        { text: "Informa a la administraci칩n si tienes un nuevo arrendatario o residente.", source: "Art칤culo 18" },
        { text: "Utiliza solo tu estacionamiento asignado. No ocupes los de visita ni 치reas comunes.", source: "Art칤culo 9" },
        { text: "Deposita la basura en bolsas bien amarradas entre las 09:00 y 22:00 horas.", source: "Art칤culo 5" },
        { text: "Los perros de razas potencialmente peligrosas deben usar bozal en 치reas comunes.", source: "Art칤culo 4" },
        { text: "Cualquier modificaci칩n a la fachada o balc칩n debe ser autorizada por la administraci칩n.", source: "Art칤culo 6" }
    ];
    function showRandomTip() {
        const randomTip = tips[Math.floor(Math.random() * tips.length)];
        document.getElementById('tip-text').textContent = randomTip.text;
        document.getElementById('tip-source').textContent = "Fuente: " + randomTip.source;
    }
    document.getElementById('show-tip').addEventListener('click', () => { showRandomTip(); showPopup('tip-popup'); });
    document.getElementById('next-tip').addEventListener('click', showRandomTip);
    document.getElementById('whatsapp-button').addEventListener('click', () => showPopup('whatsapp-popup'));
    document.getElementById('confirm-whatsapp').addEventListener('click', () => { window.open('https://wa.me/56971030049', '_blank'); hidePopup('whatsapp-popup'); });
    
    // Report Form Logic
    document.getElementById('report-button').addEventListener('click', () => showPopup('report-popup'));
    document.getElementById('report-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('report-name').value.trim() || 'An칩nimo';
        const unit = document.getElementById('report-unit').value.trim() || 'No especificada';
        const article = document.getElementById('report-article').value;
        const involved = document.getElementById('report-involved').value.trim() || 'No especificado';
        const description = document.getElementById('report-description').value.trim();

        const subject = encodeURIComponent(`Reporte de Infracci칩n: ${article}`);
        const body = encodeURIComponent(
            `Reporte de Infracci칩n\n\n` +
            `--------------------------------------\n` +
            `Reportado por: ${name}\n` +
            `Unidad del reportante: ${unit}\n` +
            `--------------------------------------\n\n` +
            `Art칤culo Involucrado: ${article}\n` +
            `Persona/Unidad Involucrada: ${involved}\n\n` +
            `Descripci칩n del incidente:\n${description}`
        );
        
        window.location.href = `mailto:Condominiocumbresdequilpue@gmail.com,comitecumbresdequilpue@gmail.com?subject=${subject}&body=${body}`;
        hidePopup('report-popup');
        this.reset();
    });

    // --- SEARCH & HIGHLIGHT LOGIC ---
    const searchInput = document.getElementById('search-input');
    const searchResultsContainer = document.getElementById('search-results');
    function clearAllHighlights() {
        document.querySelectorAll('.search-highlight-permanent').forEach(el => {
            el.replaceWith(el.textContent);
        });
    }
    function highlightTextInArticle(articleElement, term) {
        if (!term || !articleElement) return;
        const regex = new RegExp(`(${term.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
        const content = articleElement.querySelector('.article-content');
        const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);
        let node;
        const nodesToProcess = [];
        while (node = walker.nextNode()) {
            if (node.parentElement.tagName !== 'SCRIPT' && node.parentElement.tagName !== 'STYLE' && node.nodeValue.match(regex)) {
                nodesToProcess.push(node);
            }
        }
        nodesToProcess.forEach(node => {
            const span = document.createElement('span');
            span.innerHTML = node.nodeValue.replace(regex, `<span class="search-highlight-permanent">$1</span>`);
            node.parentNode.replaceChild(span, node);
        });
    }
    function performSearch() {
        clearAllHighlights();
        const searchTerm = searchInput.value.trim().toLowerCase();
        if (searchTerm.length < 3) {
            searchResultsContainer.innerHTML = '<p>Por favor, ingrese al menos 3 caracteres para buscar.</p>';
            showPopup('search-results-popup');
            return;
        }
        let resultsHTML = '';
        const regex = new RegExp(`(${searchTerm.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
        articlesData.forEach(article => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = article.content;
            const contentText = tempDiv.textContent || tempDiv.innerText || "";
            if (article.title.toLowerCase().includes(searchTerm) || contentText.toLowerCase().includes(searchTerm)) {
                let snippet = '';
                const matchIndex = contentText.toLowerCase().indexOf(searchTerm);
                if (matchIndex !== -1) {
                    const startIndex = Math.max(0, matchIndex - 50);
                    const endIndex = Math.min(contentText.length, matchIndex + 150);
                    snippet = (startIndex > 0 ? '...' : '') + contentText.substring(startIndex, endIndex) + (endIndex < contentText.length ? '...' : '');
                } else {
                    snippet = contentText.substring(0, 200) + '...';
                }
                snippet = snippet.replace(regex, `<span class="highlight">$1</span>`);
                resultsHTML += `<div class="search-result-item" data-target-id="${article.id}"><strong>${article.title}</strong><p>${snippet}</p></div>`;
            }
        });
        searchResultsContainer.innerHTML = resultsHTML || '<p>No se encontraron resultados.</p>';
        showPopup('search-results-popup');
    }
    document.getElementById('search-button').addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(); });
    searchResultsContainer.addEventListener('click', (e) => {
        const resultItem = e.target.closest('.search-result-item');
        if (resultItem) {
            const targetId = resultItem.dataset.targetId;
            const targetArticle = document.getElementById(targetId);
            if (targetArticle) {
                hidePopup('search-results-popup');
                clearAllHighlights();
                document.querySelectorAll('.article.active').forEach(active => active.classList.remove('active'));
                targetArticle.classList.add('active');
                targetArticle.scrollIntoView({ behavior: 'smooth', block: 'center' });
                highlightTextInArticle(targetArticle, searchInput.value.trim());
            }
        }
    });
    
    // --- PROGRESS BAR ---
    const progressBar = document.getElementById('progress-bar');
    window.addEventListener('scroll', () => {
        const scrollTop = document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (scrollTop / scrollHeight) * 100;
        progressBar.style.width = `${scrolled}%`;
    });

    // --- CHATBOT ---
    const chatbotFab = document.getElementById('chatbot-fab');
    const chatbotWindow = document.getElementById('chatbot-window');
    const chatbotMessages = document.getElementById('chatbot-messages');
    const chatbotInput = document.getElementById('chatbot-input');
    const chatbotSend = document.getElementById('chatbot-send');

    chatbotFab.addEventListener('click', () => {
        chatbotWindow.classList.toggle('active');
        if(chatbotWindow.classList.contains('active')) {
            chatbotInput.focus();
        }
    });

    const knowledgeBase = {
        'saludo': { keywords: ['hola', 'buenos', 'buenas'], response: '춰Hola! 游붉 Soy el asistente del condominio. 쮼n qu칠 puedo ayudarte con el reglamento?' },
        'ruido': { keywords: ['ruido', 'molestia', 'fiesta', 'musica', 'carrete', 'taladro', 'construccion'], response: 'Las normas sobre ruidos molestos est치n en el Art칤culo 1 y 2. En general, se debe evitar el ruido excesivo entre las 22:00 y 08:00. Las fiestas tienen horarios especiales los fines de semana.' },
        'mascota': { keywords: ['mascota', 'perro', 'gato', 'animal'], response: 'Todo sobre mascotas est치 en el Art칤culo 4. Deben usar correa en 치reas comunes, sus due침os deben limpiar sus desechos y los de razas peligrosas necesitan bozal.' },
        'estacionamiento': { keywords: ['estacionamiento', 'auto', 'vehiculo', 'visita', 'velocidad'], response: 'El Art칤culo 9 detalla el uso de estacionamientos. Debes usar solo el tuyo, los de visita son por un m치ximo de 8 horas y la velocidad m치xima es de 10 km/h.' },
        'basura': { keywords: ['basura', 'desecho', 'reciclaje'], response: 'El horario para botar basura es de 09:00 a 22:00, como se indica en el Art칤culo 5. Recuerda usar bolsas bien amarradas.' },
        'mudanza': { keywords: ['mudanza', 'traslado', 'camion'], response: 'Las mudanzas deben avisarse con 48 horas y tienen horarios espec칤ficos detallados en el Art칤culo 11. No se permiten los domingos ni festivos.' },
        'balcon': { keywords: ['balcon', 'terraza', 'ropa', 'asado', 'parrilla'], response: 'El Art칤culo 6 y 10 proh칤ben colgar ropa en los balcones y hacer asados con carb칩n o le침a. Revisa esos art칤culos para m치s detalles sobre la est칠tica.' },
        'multa': { keywords: ['multa', 'sancion', 'infraccion', 'apelar'], response: 'Las multas van de 1 a 3 UTM dependiendo de la gravedad de la falta. Puedes apelar una multa dentro de 15 d칤as. Todo est치 en los Art칤culos 19 y 20.' },
        'acceso': { keywords: ['acceso', 'visita', 'delivery', 'invitado', 'entrar'], response: 'El ingreso de visitas siempre debe ser autorizado por un residente. Los delivery se reciben en el acceso principal de la torre. M치s detalles en el Art칤culo 3.' },
        'comun': { keywords: ['comun', 'pasillo', 'jardin', 'fumar', 'alcohol'], response: 'En los espacios comunes est치 prohibido fumar, beber alcohol, y dejar objetos personales que obstruyan el paso. Revisa el Art칤culo 10 para ver la lista completa de prohibiciones.' },
        'arriendo': { keywords: ['arriendo', 'arrendatario', 'llaves'], response: 'El propietario es responsable de informar los datos de sus arrendatarios a la administraci칩n. Est치 prohibido arrendar estacionamientos o bodegas a personas ajenas al condominio (Art칤culo 12).' },
        'incendio': { keywords: ['incendio', 'fuego', 'colilla', 'parrilla'], response: 'Est치 estrictamente prohibido arrojar colillas encendidas o usar parrillas a carb칩n en balcones o 치reas comunes para prevenir incendios, seg칰n el Art칤culo 13.' },
        'ninos': { keywords: ['ni침os', 'juegos', 'padres', 'hijos'], response: 'Los padres son responsables por los da침os que sus hijos puedan causar en 치reas comunes. Los estacionamientos y bodegas no son zonas de juego. Revisa el Art칤culo 16.' },
        'deuda': { keywords: ['gastos comunes', 'deuda', 'moroso', 'corte de luz'], response: 'La morosidad de 3 o m치s gastos comunes puede llevar a la suspensi칩n de servicios como la electricidad, seg칰n el Art칤culo 17.' },
        'gracias': { keywords: ['gracias', 'ok', 'buena', 'vale'], response: '춰De nada! 游붉 Si tienes otra pregunta, no dudes en consultarme.' },
    };

    function addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}-message`;
        messageDiv.textContent = text;
        chatbotMessages.appendChild(messageDiv);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    }

    function getBotResponse(userInput) {
        const input = userInput.toLowerCase();
        for (const key in knowledgeBase) {
            if (knowledgeBase[key].keywords.some(k => input.includes(k))) {
                return knowledgeBase[key].response;
            }
        }
        return 'No estoy seguro de entender tu pregunta. Intenta usar palabras clave como "ruido", "mascotas", "estacionamiento" o "mudanza".';
    }

    async function handleSendMessage() {
        const userInput = chatbotInput.value.trim();
        if (userInput === '') return;

        addMessage(userInput, 'user');
        chatbotInput.value = '';
        
        const botResponse = getBotResponse(userInput);
        
        setTimeout(() => {
            addMessage(botResponse, 'bot');
        }, 800);
    }

    chatbotSend.addEventListener('click', handleSendMessage);
    chatbotInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            handleSendMessage();
        }
    });

    addMessage('춰Hola! Soy tu asistente virtual 游붉. Preg칰ntame sobre el reglamento (ej: "horario de ruidos", "normas de mascotas").', 'bot');

});
</script>

</body>
</html>

